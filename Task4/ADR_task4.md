### <a name="_b7urdng99y53"></a>**Название задачи:** Передача ставок в кол-центр — MVP расширение
### <a name="_hjk0fkfyohdk"></a>**Автор:** Команда архитектуры (совместно с ЦТ)
### <a name="_uanumrh8zrui"></a>**Дата:** 2025‑09‑06
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|| 1 | Клиент, Сотрудник КЦ, Система КЦ | Консультация по ставкам | Клиент звонит в кол-центр → сотрудник видит актуальные ставки по депозитам в системе КЦ → консультирует клиента по условиям → при желании клиента оформляет заявку. |
|| 2 | АБС, Интеграционный слой, Система КЦ | Передача ставок в КЦ | АБС публикует изменения ставок → интеграционный слой получает данные → передаёт в систему КЦ через API → ставки обновляются в реальном времени. |
|| 3 | АБС, SFTP-сервер, Партнёрский КЦ | Передача ставок партнёру | АБС ежедневно формирует файл со ставками → размещает на SFTP-сервере → партнёрский КЦ забирает файл → импортирует ставки в свою систему. |
|| 4 | Бэк-офис депозитов, АБС, SFTP | Управление файлами ставок | При изменении ставок бэк-офис инициирует внеплановую выгрузку → АБС формирует файл → размещает на SFTP → уведомляет партнёра о доступности. |
|| 5 | Партнёрский КЦ, Клиент | Консультация партнёром | Сотрудник партнёрского КЦ получает звонок → использует импортированные ставки → консультирует клиента → переводит на внутренний КЦ для оформления заявки. |
### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
|| N1 | Актуальность данных: ставки в КЦ обновляются в течение 5 минут после изменения в АБС; файлы для партнёра — ежедневно + внеплановые. |
|| N2 | Доступность: система КЦ должна работать 24/7 с доступностью 99.5%; SFTP-сервер — 99.9%. |
|| N3 | Безопасность: передача ставок через защищённые каналы (TLS 1.2+, SFTP с ключами); аудит доступа к данным. |
|| N4 | Производительность: API ставок отвечает < 200 мс; файлы генерируются < 30 сек; поддержка до 100 одновременных запросов от КЦ. |
|| N5 | Совместимость: использование существующих протоколов интеграции; минимальные изменения в системе КЦ. |
|| N6 | Мониторинг: отслеживание успешности передачи ставок, алерты при сбоях, логирование всех операций. |

|**№**|**Требование**|
| :-: | :- |
|||
### <a name="_qmphm5d6rvi3"></a>**Решение**

Диаграммы (см. файлы в `Task4/`):
- `C4_Context_Rates.mmd` — контекст передачи ставок (акторы и системы).
- `C4_Components_Rates.mmd` — компоненты: детализация интеграционного слоя и процессов передачи ставок.

Ключевые решения:
- **API для внутреннего КЦ**: расширяем интеграционный слой из Task3 новым сервисом ставок. КЦ подключается через REST API с кэшированием на стороне КЦ (TTL 5 мин).
- **SFTP для партнёрского КЦ**: АБС формирует CSV-файлы со ставками ежедневно в 00:30 и при внеплановых изменениях. Размещение на защищённом SFTP-сервере в DMZ.
- **Модуль ставок в АБС**: централизованное управление ставками с уведомлением подписчиков об изменениях через event-driven архитектуру.
- **Мониторинг**: отслеживание статуса передачи через интеграционный слой, алерты при сбоях доставки.
### <a name="_bjrr7veeh80c"></a>**Альтернативы**

- **Прямое подключение КЦ к АБС**: быстро реализовать, но создаёт нагрузку на АБС и нарушает принципы изоляции.
- **Kafka/очереди сообщений**: более надёжно для real-time обновлений, но требует существенных инвестиций в инфраструктуру.
- **Единый файловый обмен для всех**: проще в управлении, но не обеспечивает требования по актуальности для внутреннего КЦ.
- **Веб-портал для партнёров**: более удобно, но требует разработки UI и усложняет интеграцию с существующими системами партнёра.

**Недостатки, ограничения, риски**

- **Задержка обновлений для партнёрского КЦ**: файловый обмен не обеспечивает real-time актуальность, максимум — несколько раз в день.
- **Зависимость от SFTP**: сбои файлового сервера приводят к устареванию данных у партнёра.
- **Нагрузка на АБС**: формирование файлов и обслуживание API-запросов увеличивает нагрузку на основную систему.
- **Безопасность SFTP**: необходимо обеспечить защищённый канал и управление ключами доступа.
- **Мониторинг сложности**: отслеживание успешности доставки файлов и синхронизации данных требует дополнительных инструментов.

## Дополнительные материалы

- `Tasks_List.md` — детализированный список задач по системам для планирования.
- `RoadMap_MVP.drawio` — временная дорожная карта реализации на 6-12 месяцев.

